<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VEX Engine: Core/bin/Debug/_deps/zstd-src/tests/fuzz Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="RenderedLogoLowRes.png"/></td>
  <td id="projectalign">
   <div id="projectname">VEX Engine
   </div>
   <div id="projectbrief">Retro looking game engine made in vulkan mostly because i wanted to understand it better.</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('dir_521f74b41fd94971b23d007d17a403bf.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">fuzz Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-subdirs" class="groupheader"><a id="subdirs" name="subdirs"></a>
Directories</h2></td></tr>
<tr class="memitem:seq_5Fprod_5Ffuzz_5Fexample" id="r_seq_5Fprod_5Ffuzz_5Fexample"><td class="memItemLeft" align="right" valign="top"><span class="iconfolder"><div class="folder-icon"></div></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_f89d61d11e2449b6eb5de1851ac92a14.html">seq_prod_fuzz_example</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-files" class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:block_5Fdecompress_2Ec" id="r_block_5Fdecompress_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="block__decompress_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>block_decompress.c</b></td></tr>
<tr class="memitem:block_5Fround_5Ftrip_2Ec" id="r_block_5Fround_5Ftrip_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="block__round__trip_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>block_round_trip.c</b></td></tr>
<tr class="memitem:decompress_5Fcross_5Fformat_2Ec" id="r_decompress_5Fcross_5Fformat_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="decompress__cross__format_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>decompress_cross_format.c</b></td></tr>
<tr class="memitem:decompress_5FdstSize_5FtooSmall_2Ec" id="r_decompress_5FdstSize_5FtooSmall_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="decompress__dstSize__tooSmall_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>decompress_dstSize_tooSmall.c</b></td></tr>
<tr class="memitem:dictionary_5Fdecompress_2Ec" id="r_dictionary_5Fdecompress_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="dictionary__decompress_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>dictionary_decompress.c</b></td></tr>
<tr class="memitem:dictionary_5Floader_2Ec" id="r_dictionary_5Floader_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="dictionary__loader_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>dictionary_loader.c</b></td></tr>
<tr class="memitem:dictionary_5Fround_5Ftrip_2Ec" id="r_dictionary_5Fround_5Ftrip_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="dictionary__round__trip_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>dictionary_round_trip.c</b></td></tr>
<tr class="memitem:dictionary_5Fstream_5Fround_5Ftrip_2Ec" id="r_dictionary_5Fstream_5Fround_5Ftrip_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="dictionary__stream__round__trip_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>dictionary_stream_round_trip.c</b></td></tr>
<tr class="memitem:fse_5Fread_5Fncount_2Ec" id="r_fse_5Fread_5Fncount_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="fse__read__ncount_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>fse_read_ncount.c</b></td></tr>
<tr class="memitem:fuzz_2Eh" id="r_fuzz_2Eh"><td class="memItemLeft" align="right" valign="top"><a href="fuzz_8h_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>fuzz.h</b></td></tr>
<tr class="memitem:fuzz_2Epy" id="r_fuzz_2Epy"><td class="memItemLeft" align="right" valign="top"><a href="fuzz_8py_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>fuzz.py</b></td></tr>
<tr class="memitem:fuzz_5Fdata_5Fproducer_2Ec" id="r_fuzz_5Fdata_5Fproducer_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="fuzz__data__producer_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>fuzz_data_producer.c</b></td></tr>
<tr class="memitem:fuzz_5Fdata_5Fproducer_2Eh" id="r_fuzz_5Fdata_5Fproducer_2Eh"><td class="memItemLeft" align="right" valign="top"><a href="fuzz__data__producer_8h_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>fuzz_data_producer.h</b></td></tr>
<tr class="memitem:fuzz_5Fhelpers_2Ec" id="r_fuzz_5Fhelpers_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="fuzz__helpers_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>fuzz_helpers.c</b></td></tr>
<tr class="memitem:fuzz_5Fhelpers_2Eh" id="r_fuzz_5Fhelpers_2Eh"><td class="memItemLeft" align="right" valign="top"><a href="fuzz__helpers_8h_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>fuzz_helpers.h</b></td></tr>
<tr class="memitem:fuzz_5Fthird_5Fparty_5Fseq_5Fprod_2Eh" id="r_fuzz_5Fthird_5Fparty_5Fseq_5Fprod_2Eh"><td class="memItemLeft" align="right" valign="top"><a href="fuzz__third__party__seq__prod_8h_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>fuzz_third_party_seq_prod.h</b></td></tr>
<tr class="memitem:generate_5Fsequences_2Ec" id="r_generate_5Fsequences_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="generate__sequences_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>generate_sequences.c</b></td></tr>
<tr class="memitem:huf_5Fdecompress_2Ec" id="r_huf_5Fdecompress_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="tests_2fuzz_2huf__decompress_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>huf_decompress.c</b></td></tr>
<tr class="memitem:huf_5Fround_5Ftrip_2Ec" id="r_huf_5Fround_5Ftrip_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="huf__round__trip_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>huf_round_trip.c</b></td></tr>
<tr class="memitem:raw_5Fdictionary_5Fround_5Ftrip_2Ec" id="r_raw_5Fdictionary_5Fround_5Ftrip_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="raw__dictionary__round__trip_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>raw_dictionary_round_trip.c</b></td></tr>
<tr class="memitem:regression_5Fdriver_2Ec" id="r_regression_5Fdriver_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="regression__driver_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>regression_driver.c</b></td></tr>
<tr class="memitem:seekable_5Froundtrip_2Ec" id="r_seekable_5Froundtrip_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="seekable__roundtrip_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>seekable_roundtrip.c</b></td></tr>
<tr class="memitem:sequence_5Fcompression_5Fapi_2Ec" id="r_sequence_5Fcompression_5Fapi_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="sequence__compression__api_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>sequence_compression_api.c</b></td></tr>
<tr class="memitem:simple_5Fcompress_2Ec" id="r_simple_5Fcompress_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="simple__compress_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>simple_compress.c</b></td></tr>
<tr class="memitem:simple_5Fdecompress_2Ec" id="r_simple_5Fdecompress_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="simple__decompress_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>simple_decompress.c</b></td></tr>
<tr class="memitem:simple_5Fround_5Ftrip_2Ec" id="r_simple_5Fround_5Ftrip_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="simple__round__trip_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>simple_round_trip.c</b></td></tr>
<tr class="memitem:stream_5Fdecompress_2Ec" id="r_stream_5Fdecompress_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="stream__decompress_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>stream_decompress.c</b></td></tr>
<tr class="memitem:stream_5Fround_5Ftrip_2Ec" id="r_stream_5Fround_5Ftrip_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="stream__round__trip_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>stream_round_trip.c</b></td></tr>
<tr class="memitem:zstd_5Fframe_5Finfo_2Ec" id="r_zstd_5Fframe_5Finfo_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="zstd__frame__info_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>zstd_frame_info.c</b></td></tr>
<tr class="memitem:zstd_5Fhelpers_2Ec" id="r_zstd_5Fhelpers_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="zstd__helpers_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>zstd_helpers.c</b></td></tr>
<tr class="memitem:zstd_5Fhelpers_2Eh" id="r_zstd_5Fhelpers_2Eh"><td class="memItemLeft" align="right" valign="top"><a href="zstd__helpers_8h_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>zstd_helpers.h</b></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<h1 class="doxsection"><a class="anchor" id="autotoc_md238"></a>
Fuzzing</h1>
<p>Each fuzzing target can be built with multiple engines. Zstd provides a fuzz corpus for each target that can be downloaded with the command:</p>
<div class="fragment"><div class="line">make corpora</div>
</div><!-- fragment --><p>It will download each corpus into <span class="tt">./corpora/TARGET</span>.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md239"></a>
fuzz.py</h1>
<p><span class="tt"><a class="el" href="fuzz_8py_source.html">fuzz.py</a></span> is a helper script for building and running fuzzers. Run <span class="tt">./fuzz.py -h</span> for the commands and run <span class="tt">./fuzz.py COMMAND -h</span> for command specific help.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md240"></a>
Generating Data</h2>
<p><span class="tt"><a class="el" href="fuzz_8py_source.html">fuzz.py</a></span> provides a utility to generate seed data for each fuzzer.</p>
<div class="fragment"><div class="line">make -C ../tests decodecorpus</div>
<div class="line">./fuzz.py gen TARGET</div>
</div><!-- fragment --><p>By default it outputs 100 samples, each at most 8KB into <span class="tt">corpora/TARGET-seed</span>, but that can be configured with the <span class="tt">--number</span>, <span class="tt">--max-size-log</span> and <span class="tt">--seed</span> flags.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md241"></a>
Build</h2>
<p>It respects the usual build environment variables <span class="tt">CC</span>, <span class="tt">CFLAGS</span>, etc. The environment variables can be overridden with the corresponding flags <span class="tt">--cc</span>, <span class="tt">--cflags</span>, etc. The specific fuzzing engine is selected with <span class="tt">LIB_FUZZING_ENGINE</span> or <span class="tt">--lib-fuzzing-engine</span>, the default is <span class="tt">libregression.a</span>. Alternatively, you can use Clang's built in fuzzing engine with <span class="tt">--enable-fuzzer</span>. It has flags that can easily set up sanitizers <span class="tt">--enable-{a,ub,m}san</span>, and coverage instrumentation <span class="tt">--enable-coverage</span>. It sets sane defaults which can be overridden with flags <span class="tt">--debug</span>, <span class="tt">--enable-ubsan-pointer-overflow</span>, etc. Run <span class="tt">./fuzz.py build -h</span> for help.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md242"></a>
Running Fuzzers</h2>
<p><span class="tt">./fuzz.py</span> can run <span class="tt">libfuzzer</span>, <span class="tt">afl</span>, and <span class="tt">regression</span> tests. See the help of the relevant command for options. Flags not parsed by <span class="tt"><a class="el" href="fuzz_8py_source.html">fuzz.py</a></span> are passed to the fuzzing engine. The command used to run the fuzzer is printed for debugging.</p>
<p>Here's a helpful command to fuzz each target across all cores, stopping only if a bug is found: </p><div class="fragment"><div class="line">for target in $(./fuzz.py list); do</div>
<div class="line">    ./fuzz.py libfuzzer $target -jobs=10 -workers=10 -max_total_time=1000 || break;</div>
<div class="line">done</div>
</div><!-- fragment --><p> Alternatively, you can fuzz all targets in parallel, using one core per target: </p><div class="fragment"><div class="line">python3 ./fuzz.py list | xargs -P$(python3 ./fuzz.py list | wc -l) -I__ sh -c &quot;python3 ./fuzz.py libfuzzer __ 2&gt;&amp;1 | tee __.log&quot;</div>
</div><!-- fragment --><p> Either way, to double-check that no crashes were found, run <span class="tt">ls corpora/*crash</span>. If any crashes were found, you can use the hashes to reproduce them.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md243"></a>
LibFuzzer</h1>
<div class="fragment"><div class="line"># Build the fuzz targets</div>
<div class="line">./fuzz.py build all --enable-fuzzer --enable-asan --enable-ubsan --cc clang --cxx clang++</div>
<div class="line"># OR equivalently</div>
<div class="line">CC=clang CXX=clang++ ./fuzz.py build all --enable-fuzzer --enable-asan --enable-ubsan</div>
<div class="line"># Run the fuzzer</div>
<div class="line">./fuzz.py libfuzzer TARGET &lt;libfuzzer args like -jobs=4&gt;</div>
</div><!-- fragment --><p>where <span class="tt">TARGET</span> could be <span class="tt">simple_decompress</span>, <span class="tt">stream_round_trip</span>, etc.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md244"></a>
MSAN</h2>
<p>Fuzzing with <span class="tt">libFuzzer</span> and <span class="tt">MSAN</span> is as easy as:</p>
<div class="fragment"><div class="line">CC=clang CXX=clang++ ./fuzz.py build all --enable-fuzzer --enable-msan</div>
<div class="line">./fuzz.py libfuzzer TARGET &lt;libfuzzer args&gt;</div>
</div><!-- fragment --><p><span class="tt"><a class="el" href="fuzz_8py_source.html">fuzz.py</a></span> respects the environment variables / flags <span class="tt">MSAN_EXTRA_CPPFLAGS</span>, <span class="tt">MSAN_EXTRA_CFLAGS</span>, <span class="tt">MSAN_EXTRA_CXXFLAGS</span>, <span class="tt">MSAN_EXTRA_LDFLAGS</span> to easily pass the extra parameters only for MSAN.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md245"></a>
AFL</h1>
<p>The default <span class="tt">LIB_FUZZING_ENGINE</span> is <span class="tt">libregression.a</span>, which produces a binary that AFL can use.</p>
<div class="fragment"><div class="line"># Build the fuzz targets</div>
<div class="line">CC=afl-clang CXX=afl-clang++ ./fuzz.py build all --enable-asan --enable-ubsan</div>
<div class="line"># Run the fuzzer without a memory limit because of ASAN</div>
<div class="line">./fuzz.py afl TARGET -m none</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md246"></a>
Regression Testing</h1>
<p>The regression test supports the <span class="tt">all</span> target to run all the fuzzers in one command.</p>
<div class="fragment"><div class="line">CC=clang CXX=clang++ ./fuzz.py build all --enable-asan --enable-ubsan</div>
<div class="line">./fuzz.py regression all</div>
<div class="line">CC=clang CXX=clang++ ./fuzz.py build all --enable-msan</div>
<div class="line">./fuzz.py regression all</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md247"></a>
Fuzzing a custom sequence producer plugin</h1>
<p>Sequence producer plugin authors can use the zstd fuzzers to stress-test their code. See the documentation in <span class="tt"><a class="el" href="fuzz__third__party__seq__prod_8h_source.html">fuzz_third_party_seq_prod.h</a></span> for details.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md248"></a>
Adding a new fuzzer</h1>
<p>There are several steps involved in adding a new fuzzer harness.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md249"></a>
Build your harness</h2>
<ol type="1">
<li>Create a new your fuzzer harness <span class="tt">tests/fuzz/your_harness.c</span>.</li>
<li><p class="startli">Add your harness to the Makefile</p>
<p class="startli">2.1 Follow <a href="https://github.com/facebook/zstd/blob/e124e39301381de8f323436a3e4c46539747ba24/tests/fuzz/Makefile#L216">this example</a> if your fuzzer requires both compression and decompression symbols (prefix <span class="tt">rt_</span>). If your fuzzer only requires decompression symbols, follow <a href="https://github.com/facebook/zstd/blob/6a0052a409e2604bd40354b76b86272b712edd7d/tests/fuzz/Makefile#L194">this example</a> (prefix <span class="tt">d_</span>).</p>
<p class="startli">2.2 Add your target to <a href="https://github.com/facebook/zstd/blob/6a0052a409e2604bd40354b76b86272b712edd7d/tests/fuzz/Makefile#L108"><span class="tt">FUZZ_TARGETS</span></a>.</p>
</li>
<li>Add your harness to <a href="https://github.com/facebook/zstd/blob/6a0052a409e2604bd40354b76b86272b712edd7d/tests/fuzz/fuzz.py#L48"><span class="tt">fuzz.py</span></a>.</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md250"></a>
Generate seed data</h2>
<p>Follow the instructions above to generate seed data: </p><div class="fragment"><div class="line">make -C ../tests decodecorpus</div>
<div class="line">./fuzz.py gen your_harness</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md251"></a>
Run the harness</h2>
<p>Follow the instructions above to run your harness and fix any crashes: </p><div class="fragment"><div class="line">./fuzz.py build your_harness --enable-fuzzer --enable-asan --enable-ubsan --cc clang --cxx clang++</div>
<div class="line">./fuzz.py libfuzzer your_harness</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md252"></a>
Minimize and zip the corpus</h2>
<p>After running the fuzzer for a while, you will have a large corpus at <span class="tt">tests/fuzz/corpora/your_harness*</span>. This corpus must be minimized and zipped before uploading to GitHub for regression testing: </p><div class="fragment"><div class="line">./fuzz.py minimize your_harness</div>
<div class="line">./fuzz.py zip your_harness </div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md253"></a>
Upload the zip file to GitHub</h2>
<p>The previous step should produce a <span class="tt">.zip</span> file containing the corpus for your new harness. This corpus must be uploaded to GitHub here: <a href="https://github.com/facebook/zstd/releases/tag/fuzz-corpora">https://github.com/facebook/zstd/releases/tag/fuzz-corpora</a> </p>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_c6310732a22f63c0c2fc5595561e68f1.html">Core</a></li><li class="navelem"><a href="dir_6c155c6ed2482937e47e44c0ec262982.html">bin</a></li><li class="navelem"><a href="dir_6469104bc24381b08969a83caf11cffb.html">Debug</a></li><li class="navelem"><a href="dir_6bbd6f73285aef4922f9164785e3a6d0.html">_deps</a></li><li class="navelem"><a href="dir_6db096f061106655854804296419a647.html">zstd-src</a></li><li class="navelem"><a href="dir_d96a6df65abaaa44034ca58a0e200722.html">tests</a></li><li class="navelem"><a href="dir_521f74b41fd94971b23d007d17a403bf.html">fuzz</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
