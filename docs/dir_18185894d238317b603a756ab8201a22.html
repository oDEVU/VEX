<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VEX Engine: Core/bin/Debug/_deps/zstd-src/zlibWrapper Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="RenderedLogoLowRes.png"/></td>
  <td id="projectalign">
   <div id="projectname">VEX Engine
   </div>
   <div id="projectbrief">Retro looking game engine made in vulkan mostly because i wanted to understand it better.</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('dir_18185894d238317b603a756ab8201a22.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">zlibWrapper Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-subdirs" class="groupheader"><a id="subdirs" name="subdirs"></a>
Directories</h2></td></tr>
<tr class="memitem:examples" id="r_examples"><td class="memItemLeft" align="right" valign="top"><span class="iconfolder"><div class="folder-icon"></div></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_77362499da2c4de0638d351a23cab506.html">examples</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-files" class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:gzclose_2Ec" id="r_gzclose_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="gzclose_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>gzclose.c</b></td></tr>
<tr class="memitem:gzcompatibility_2Eh" id="r_gzcompatibility_2Eh"><td class="memItemLeft" align="right" valign="top"><a href="gzcompatibility_8h_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>gzcompatibility.h</b></td></tr>
<tr class="memitem:gzguts_2Eh" id="r_gzguts_2Eh"><td class="memItemLeft" align="right" valign="top"><a href="gzguts_8h_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>gzguts.h</b></td></tr>
<tr class="memitem:gzlib_2Ec" id="r_gzlib_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="gzlib_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>gzlib.c</b></td></tr>
<tr class="memitem:gzread_2Ec" id="r_gzread_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="gzread_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>gzread.c</b></td></tr>
<tr class="memitem:gzwrite_2Ec" id="r_gzwrite_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="gzwrite_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>gzwrite.c</b></td></tr>
<tr class="memitem:zstd_5Fzlibwrapper_2Ec" id="r_zstd_5Fzlibwrapper_2Ec"><td class="memItemLeft" align="right" valign="top"><a href="zstd__zlibwrapper_8c_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>zstd_zlibwrapper.c</b></td></tr>
<tr class="memitem:zstd_5Fzlibwrapper_2Eh" id="r_zstd_5Fzlibwrapper_2Eh"><td class="memItemLeft" align="right" valign="top"><a href="zstd__zlibwrapper_8h_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>zstd_zlibwrapper.h</b></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<p>The main objective of creating a zstd wrapper for <a href="https://zlib.net/">zlib</a> is to allow a quick and smooth transition to zstd for projects already using zlib.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md262"></a>
Required files</h3>
<p>To build the zstd wrapper for zlib the following files are required:</p><ul>
<li>zlib.h</li>
<li>a static or dynamic zlib library</li>
<li><a class="el" href="zstd__zlibwrapper_8h_source.html">zlibWrapper/zstd_zlibwrapper.h</a></li>
<li><a class="el" href="zstd__zlibwrapper_8c_source.html">zlibWrapper/zstd_zlibwrapper.c</a></li>
<li>zlibWrapper/gz*.c files (<a class="el" href="gzclose_8c_source.html">gzclose.c</a>, <a class="el" href="gzlib_8c_source.html">gzlib.c</a>, <a class="el" href="gzread_8c_source.html">gzread.c</a>, <a class="el" href="gzwrite_8c_source.html">gzwrite.c</a>)</li>
<li>zlibWrapper/gz*.h files (<a class="el" href="gzcompatibility_8h_source.html">gzcompatibility.h</a>, <a class="el" href="gzguts_8h_source.html">gzguts.h</a>)</li>
<li>a static or dynamic zstd library</li>
</ul>
<p>The first two files are required by all projects using zlib and they are not included with the zstd distribution. The further files are supplied with the zstd distribution.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md263"></a>
Embedding the zstd wrapper within your project</h3>
<p>Let's assume that your project that uses zlib is compiled with: </p><div class="fragment"><div class="line">project.o -lz</div>
</div><!-- fragment --><p>To compile the zstd wrapper with your project you have to do the following:</p><ul>
<li>change all references with <span class="tt">#include "zlib.h"</span> to <span class="tt">#include "zstd_zlibwrapper.h"</span></li>
<li>compile your project with <span class="tt"><a class="el" href="zstd__zlibwrapper_8c_source.html">zstd_zlibwrapper.c</a></span>, <span class="tt">gz*.c</span> and a static or dynamic zstd library</li>
</ul>
<p>The linking should be changed to: </p><div class="fragment"><div class="line">project.o zstd_zlibwrapper.o gz*.c -lz -lzstd</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md264"></a>
Enabling zstd compression within your project</h3>
<p>After embedding the zstd wrapper within your project the zstd library is turned off by default. Your project should work as before with zlib. There are two options to enable zstd compression:</p><ul>
<li>compilation with <span class="tt">-DZWRAP_USE_ZSTD=1</span> (or using <span class="tt">#define ZWRAP_USE_ZSTD 1</span> before <span class="tt">#include "zstd_zlibwrapper.h"</span>)</li>
<li>using the <span class="tt">void ZWRAP_useZSTDcompression(int turn_on)</span> function (declared in <span class="tt">#include "zstd_zlibwrapper.h"</span>)</li>
</ul>
<p>During decompression zlib and zstd streams are automatically detected and decompressed using a proper library. This behavior can be changed using <span class="tt">ZWRAP_setDecompressionType(ZWRAP_FORCE_ZLIB)</span> what will make zlib decompression slightly faster.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md265"></a>
Example</h3>
<p>We have taken the file <span class="tt">test/example.c</span> from <a href="https://zlib.net/">the zlib library distribution</a> and copied it to <a href="examples/example.c">zlibWrapper/examples/example.c</a>. After compilation and execution it shows the following results: </p><div class="fragment"><div class="line">zlib version 1.2.8 = 0x1280, compile flags = 0x65</div>
<div class="line">uncompress(): hello, hello!</div>
<div class="line">gzread(): hello, hello!</div>
<div class="line">gzgets() after gzseek:  hello!</div>
<div class="line">inflate(): hello, hello!</div>
<div class="line">large_inflate(): OK</div>
<div class="line">after inflateSync(): hello, hello!</div>
<div class="line">inflate with dictionary: hello, hello!</div>
</div><!-- fragment --><p> Then we have changed <span class="tt">#include "zlib.h"</span> to <span class="tt">#include "zstd_zlibwrapper.h"</span>, compiled the <a href="examples/example.c">example.c</a> file with <span class="tt">-DZWRAP_USE_ZSTD=1</span> and linked with additional <span class="tt">zstd_zlibwrapper.o gz*.c -lzstd</span>. We were forced to turn off the following functions: <span class="tt">test_flush</span>, <span class="tt">test_sync</span> which use currently unsupported features. After running it shows the following results: </p><div class="fragment"><div class="line">zlib version 1.2.8 = 0x1280, compile flags = 0x65</div>
<div class="line">uncompress(): hello, hello!</div>
<div class="line">gzread(): hello, hello!</div>
<div class="line">gzgets() after gzseek:  hello!</div>
<div class="line">inflate(): hello, hello!</div>
<div class="line">large_inflate(): OK</div>
<div class="line">inflate with dictionary: hello, hello!</div>
</div><!-- fragment --><p> The script used for compilation can be found at [zlibWrapper/Makefile](Makefile).</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md266"></a>
The measurement of performance of Zstandard wrapper for zlib</h3>
<p>The zstd distribution contains a tool called <span class="tt">zwrapbench</span> which can measure speed and ratio of zlib, zstd, and the wrapper. The benchmark is conducted using given filenames or synthetic data if filenames are not provided. The files are read into memory and processed independently. It makes benchmark more precise as it eliminates I/O overhead. Many filenames can be supplied as multiple parameters, parameters with wildcards or names of directories can be used as parameters with the -r option. One can select compression levels starting from <span class="tt">-b</span> and ending with <span class="tt">-e</span>. The <span class="tt">-i</span> parameter selects minimal time used for each of tested levels. With <span class="tt">-B</span> option bigger files can be divided into smaller, independently compressed blocks. The benchmark tool can be compiled with <span class="tt">make zwrapbench</span> using [zlibWrapper/Makefile](Makefile).</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md267"></a>
Improving speed of streaming compression</h3>
<p>During streaming compression the compressor never knows how big is data to compress. Zstandard compression can be improved by providing size of source data to the compressor. By default streaming compressor assumes that data is bigger than 256 KB but it can hurt compression speed on smaller data. The zstd wrapper provides the <span class="tt">ZWRAP_setPledgedSrcSize()</span> function that allows to change a pledged source size for a given compression stream. The function will change zstd compression parameters what may improve compression speed and/or ratio. It should be called just after <span class="tt">deflateInit()</span>or <span class="tt">deflateReset()</span> and before <span class="tt">deflate()</span> or <span class="tt">deflateSetDictionary()</span>. The function is only helpful when data is compressed in blocks. There will be no change in case of <span class="tt">deflateInit()</span> or <span class="tt">deflateReset()</span> immediately followed by <span class="tt">deflate(strm, Z_FINISH)</span> as this case is automatically detected.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md268"></a>
Reusing contexts</h3>
<p>The ordinary zlib compression of two files/streams allocates two contexts:</p><ul>
<li>for the 1st file calls <span class="tt">deflateInit</span>, <span class="tt">deflate</span>, <span class="tt">...</span>, <span class="tt">deflate</span>, <span class="tt">deflateEnd</span></li>
<li>for the 2nd file calls <span class="tt">deflateInit</span>, <span class="tt">deflate</span>, <span class="tt">...</span>, <span class="tt">deflate</span>, <span class="tt">deflateEnd</span></li>
</ul>
<p>The speed of compression can be improved with reusing a single context with following steps:</p><ul>
<li>initialize the context with <span class="tt">deflateInit</span></li>
<li>for the 1st file call <span class="tt">deflate</span>, <span class="tt">...</span>, <span class="tt">deflate</span></li>
<li>for the 2nd file call <span class="tt">deflateReset</span>, <span class="tt">deflate</span>, <span class="tt">...</span>, <span class="tt">deflate</span></li>
<li>free the context with <span class="tt">deflateEnd</span></li>
</ul>
<p>To check the difference we made experiments using <span class="tt">zwrapbench -ri6b6</span> with zstd and zlib compression (both at level 6). The input data was decompressed git repository downloaded from <a href="https://github.com/git/git/archive/master.zip">https://github.com/git/git/archive/master.zip</a> which contains 2979 files. The table below shows that reusing contexts has a minor influence on zlib but it gives improvement for zstd. In our example (the last 2 lines) it gives 4% better compression speed and 5% better decompression speed.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Compression type  </th><th class="markdownTableHeadNone">Compression  </th><th class="markdownTableHeadNone">Decompress.  </th><th class="markdownTableHeadNone">Compr. size  </th><th class="markdownTableHeadNone">Ratio  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">zlib 1.2.8  </td><td class="markdownTableBodyNone">30.51 MB/s  </td><td class="markdownTableBodyNone">219.3 MB/s  </td><td class="markdownTableBodyNone">6819783  </td><td class="markdownTableBodyNone">3.459  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">zlib 1.2.8 not reusing a context  </td><td class="markdownTableBodyNone">30.22 MB/s  </td><td class="markdownTableBodyNone">218.1 MB/s  </td><td class="markdownTableBodyNone">6819783  </td><td class="markdownTableBodyNone">3.459  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">zlib 1.2.8 with zlibWrapper and reusing a context  </td><td class="markdownTableBodyNone">30.40 MB/s  </td><td class="markdownTableBodyNone">218.9 MB/s  </td><td class="markdownTableBodyNone">6819783  </td><td class="markdownTableBodyNone">3.459  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">zlib 1.2.8 with zlibWrapper not reusing a context  </td><td class="markdownTableBodyNone">30.28 MB/s  </td><td class="markdownTableBodyNone">218.1 MB/s  </td><td class="markdownTableBodyNone">6819783  </td><td class="markdownTableBodyNone">3.459  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">zstd 1.1.0 using ZSTD_CCtx  </td><td class="markdownTableBodyNone">68.35 MB/s  </td><td class="markdownTableBodyNone">430.9 MB/s  </td><td class="markdownTableBodyNone">6868521  </td><td class="markdownTableBodyNone">3.435  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">zstd 1.1.0 using ZSTD_CStream  </td><td class="markdownTableBodyNone">66.63 MB/s  </td><td class="markdownTableBodyNone">422.3 MB/s  </td><td class="markdownTableBodyNone">6868521  </td><td class="markdownTableBodyNone">3.435  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">zstd 1.1.0 with zlibWrapper and reusing a context  </td><td class="markdownTableBodyNone">54.01 MB/s  </td><td class="markdownTableBodyNone">403.2 MB/s  </td><td class="markdownTableBodyNone">6763482  </td><td class="markdownTableBodyNone">3.488  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">zstd 1.1.0 with zlibWrapper not reusing a context  </td><td class="markdownTableBodyNone">51.59 MB/s  </td><td class="markdownTableBodyNone">383.7 MB/s  </td><td class="markdownTableBodyNone">6763482  </td><td class="markdownTableBodyNone">3.488  </td></tr>
</table>
<h3 class="doxsection"><a class="anchor" id="autotoc_md269"></a>
Compatibility issues</h3>
<p>After enabling zstd compression not all native zlib functions are supported. When calling unsupported methods they put error message into <span class="tt">strm-&gt;msg</span> and return Z_STREAM_ERROR.</p>
<p>Supported methods:</p><ul>
<li>deflateInit</li>
<li>deflate (with exception of Z_FULL_FLUSH, Z_BLOCK, and Z_TREES)</li>
<li>deflateSetDictionary</li>
<li>deflateEnd</li>
<li>deflateReset</li>
<li>deflateBound</li>
<li>inflateInit</li>
<li>inflate</li>
<li>inflateSetDictionary</li>
<li>inflateReset</li>
<li>inflateReset2</li>
<li>compress</li>
<li>compress2</li>
<li>compressBound</li>
<li>uncompress</li>
<li>gzip file access functions</li>
</ul>
<p>Ignored methods (they do nothing):</p><ul>
<li>deflateParams</li>
</ul>
<p>Unsupported methods:</p><ul>
<li>deflateCopy</li>
<li>deflateTune</li>
<li>deflatePending</li>
<li>deflatePrime</li>
<li>deflateSetHeader</li>
<li>inflateGetDictionary</li>
<li>inflateCopy</li>
<li>inflateSync</li>
<li>inflatePrime</li>
<li>inflateMark</li>
<li>inflateGetHeader</li>
<li>inflateBackInit</li>
<li>inflateBack</li>
<li>inflateBackEnd </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_c6310732a22f63c0c2fc5595561e68f1.html">Core</a></li><li class="navelem"><a href="dir_6c155c6ed2482937e47e44c0ec262982.html">bin</a></li><li class="navelem"><a href="dir_6469104bc24381b08969a83caf11cffb.html">Debug</a></li><li class="navelem"><a href="dir_6bbd6f73285aef4922f9164785e3a6d0.html">_deps</a></li><li class="navelem"><a href="dir_6db096f061106655854804296419a647.html">zstd-src</a></li><li class="navelem"><a href="dir_18185894d238317b603a756ab8201a22.html">zlibWrapper</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
