<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VEX Engine: Core/bin/Debug/_deps/zstd-src/tests/cli-tests Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="RenderedLogoLowRes.png"/></td>
  <td id="projectalign">
   <div id="projectname">VEX Engine
   </div>
   <div id="projectbrief">Retro looking game engine made in vulkan mostly because i wanted to understand it better.</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('dir_a7ef9f30002de756fbd7fdf8e5bff6f7.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">cli-tests Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-files" class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:run_2Epy" id="r_run_2Epy"><td class="memItemLeft" align="right" valign="top"><a href="run_8py_source.html"><span class="icondoc"><div class="doc-icon"></div></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>run.py</b></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<h1 class="doxsection"><a class="anchor" id="autotoc_md226"></a>
CLI tests</h1>
<p>The CLI tests are focused on testing the zstd CLI. They are intended to be simple tests that the CLI and arguments work as advertised. They are not intended to test the library, only the code in <span class="tt">programs/</span>. The library will get incidental coverage, but if you find yourself trying to trigger a specific condition in the library, this is the wrong tool.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md227"></a>
Test runner usage</h1>
<p>The test runner <span class="tt"><a class="el" href="run_8py_source.html">run.py</a></span> will run tests against the in-tree build of <span class="tt">zstd</span> and <span class="tt">datagen</span> by default. Which means that <span class="tt">zstd</span> and <span class="tt">datagen</span> must be built.</p>
<p>The <span class="tt">zstd</span> binary used can be passed with <span class="tt">--zstd /path/to/zstd</span>. Additionally, to run <span class="tt">zstd</span> through a tool like <span class="tt">valgrind</span> or <span class="tt">qemu</span>, set the &lsquo;--exec-prefix 'valgrind -q&rsquo;` flag.</p>
<p>Similarly, the <span class="tt">--datagen</span>, and <span class="tt">--zstdgrep</span> flags can be set to specify the paths to their respective binaries. However, these tools do not use the <span class="tt">EXEC_PREFIX</span>.</p>
<p>Each test executes in its own scratch directory under <span class="tt">scratch/test/name</span>. E.g. <span class="tt">scratch/basic/help.sh/</span>. Normally these directories are removed after the test executes. However, the <span class="tt">--preserve</span> flag will preserve these directories after execution, and save the tests exit code, stdout, and stderr in the scratch directory to <span class="tt">exit</span>, <span class="tt">stderr</span>, and <span class="tt">stdout</span> respectively. This can be useful for debugging/editing a test and updating the expected output.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md228"></a>
Running all the tests</h2>
<p>By default the test runner <span class="tt"><a class="el" href="run_8py_source.html">run.py</a></span> will run all the tests, and report the results.</p>
<p>Examples:</p>
<div class="fragment"><div class="line">./run.py</div>
<div class="line">./run.py --preserve</div>
<div class="line">./run.py --zstd ../../build/programs/zstd --datagen ../../build/tests/datagen</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md229"></a>
Running specific tests</h2>
<p>A set of test names can be passed to the test runner <span class="tt"><a class="el" href="run_8py_source.html">run.py</a></span> to only execute those tests. This can be useful for writing or debugging a test, especially with <span class="tt">--preserve</span>.</p>
<p>The test name can either be the path to the test file, or the test name, which is the path relative to the test directory.</p>
<p>Examples:</p>
<div class="fragment"><div class="line">./run.py basic/help.sh</div>
<div class="line">./run.py --preserve basic/help.sh basic/version.sh</div>
<div class="line">./run.py --preserve --verbose basic/help.sh</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md230"></a>
Updating exact output</h2>
<p>If a test is failing because a <span class="tt">.stderr.exact</span> or <span class="tt">.stdout.exact</span> no longer matches, you can re-run the tests with <span class="tt">--set-exact-output</span> and the correct output will be written.</p>
<p>Example: </p><div class="fragment"><div class="line">./run.py --set-exact-output</div>
<div class="line">./run.py basic/help.sh --set-exact-output</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md231"></a>
Writing a test</h1>
<p>Test cases are arbitrary executables, and can be written in any language, but are generally shell scripts. After the script executes, the exit code, stderr, and stdout are compared against the expectations.</p>
<p>Each test is run in a clean directory that the test can use for intermediate files. This directory will be cleaned up at the end of the test, unless <span class="tt">--preserve</span> is passed to the test runner. Additionally, the <span class="tt">setup</span> script can prepare the directory before the test runs.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md232"></a>
Calling zstd, utilities, and environment variables</h2>
<p>The <span class="tt">$PATH</span> for tests is prepended with the <span class="tt">bin/</span> sub-directory, which contains helper scripts for ease of testing. The <span class="tt">zstd</span> binary will call the zstd binary specified by <span class="tt"><a class="el" href="run_8py_source.html">run.py</a></span> with the correct <span class="tt">$EXEC_PREFIX</span>. Similarly, <span class="tt">datagen</span>, <span class="tt">unzstd</span>, <span class="tt">zstdgrep</span>, <span class="tt">zstdcat</span>, etc, are provided.</p>
<p>Helper utilities like <span class="tt">cmp_size</span>, <span class="tt">println</span>, and <span class="tt">die</span> are provided here too. See their scripts for details.</p>
<p>Common shell script libraries are provided under <span class="tt">common/</span>, with helper variables and functions. They can be sourced with <span class="tt">source "$COMMON/library.sh&lt;/tt&gt;.

Lastly, environment variables are provided for testing, which can be listed when calling &lt;tt&gt;run.py&lt;/tt&gt; with &lt;tt&gt;--verbose&lt;/tt&gt;.
They are generally used by the helper scripts in &lt;tt&gt;bin/&lt;/tt&gt; to coordinate everything.

@subsection autotoc_md233 Basic test case

When executing your &lt;tt&gt;\$TEST&lt;/tt&gt; executable, by default the exit code is expected to be &lt;tt&gt;0&lt;/tt&gt;. However, you can provide an alternate expected exit code in a &lt;tt&gt;\$TEST.exit&lt;/tt&gt; file.

When executing your &lt;tt&gt;\$TEST&lt;/tt&gt; executable, by default the expected stderr and stdout are empty. However, you can override the default by providing one of three files:

* &lt;tt&gt;\$TEST.{stdout,stderr}.exact&lt;/tt&gt;
* &lt;tt&gt;\$TEST.{stdout,stderr}.glob&lt;/tt&gt;
* &lt;tt&gt;\$TEST.{stdout,stderr}.ignore&lt;/tt&gt;

If you provide a &lt;tt&gt;.exact&lt;/tt&gt; file, the output is expected to exactly match, byte-for-byte.

If you provide a &lt;tt&gt;.glob&lt;/tt&gt; file, the output is expected to match the expected file, where each line is interpreted as a glob syntax. Additionally, a line containing only &lt;tt&gt;...&lt;/tt&gt; matches all lines until the next expected line matches.

If you provide a &lt;tt&gt;.ignore&lt;/tt&gt; file, the output is ignored.

@subsubsection autotoc_md234 Passing examples

All these examples pass.

Exit 1, and change the expectation to be 1.

@icode 
exit-1.sh
---
#!/bin/sh
exit 1
---

exit-1.sh.exit
---
1
---
@endicode 

Check the stdout output exactly matches.

@icode 
echo.sh
---
#!/bin/sh
echo "hello world"
---</span></p>
<p><span class="tt">echo.sh.stdout.exact
---
hello world
---
</span></p>
<p><span class="tt">Check the stderr output using a glob.</span></p>
<p><span class="tt"></p><div class="fragment"><div class="line">random.sh</div>
<div class="line">---</div>
<div class="line">#!/bin/sh</div>
<div class="line">head -c 10 &lt; /dev/urandom | xxd &gt;&amp;2</div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">random.sh.stderr.glob</div>
<div class="line">---</div>
<div class="line">00000000: * * * * *                 *</div>
</div><!-- fragment --><p></span></p>
<p><span class="tt">Multiple lines can be matched with ...</span></p>
<p><span class="tt"></p><div class="fragment"><div class="line">random-num-lines.sh</div>
<div class="line">---</div>
<div class="line">#!/bin/sh</div>
<div class="line">echo hello</div>
<div class="line">seq 0 $RANDOM</div>
<div class="line">echo world</div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">random-num-lines.sh.stdout.glob</div>
<div class="line">---</div>
<div class="line">hello</div>
<div class="line">0</div>
<div class="line">...</div>
<div class="line">world</div>
<div class="line">---</div>
</div><!-- fragment --><p></span></p>
<p><span class="tt"></span></p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md235"></a>
<span class="tt">Failing examples</span></h3>
<p><span class="tt"></span></p>
<p><span class="tt">Exit code is expected to be 0, but is 1.</span></p>
<p><span class="tt"></p><div class="fragment"><div class="line">exit-1.sh</div>
<div class="line">---</div>
<div class="line">#!/bin/sh</div>
<div class="line">exit 1</div>
<div class="line">---</div>
</div><!-- fragment --><p></span></p>
<p><span class="tt">Stdout is expected to be empty, but isn't.</span></p>
<p><span class="tt"></p><div class="fragment"><div class="line">echo.sh</div>
<div class="line">---</div>
<div class="line">#!/bin/sh</div>
<div class="line">echo hello world</div>
</div><!-- fragment --><p></span></p>
<p><span class="tt">Stderr is expected to be hello but is world.</span></p>
<p><span class="tt"></p><div class="fragment"><div class="line">hello.sh</div>
<div class="line">---</div>
<div class="line">#!/bin/sh</div>
<div class="line">echo world &gt;&amp;2</div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">hello.sh.stderr.exact</div>
<div class="line">---</div>
<div class="line">hello</div>
<div class="line">---</div>
</div><!-- fragment --><p></span></p>
<p><span class="tt"></span></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md236"></a>
<span class="tt">Setup &amp; teardown scripts</span></h2>
<p><span class="tt"></span></p>
<p><span class="tt">Finally, test writing can be eased with setup and teardown scripts.
Each directory in the test directory is a test-suite consisting of all tests within that directory (but not sub-directories).
This test suite can come with 4 scripts to help test writing:</span></p>
<p><span class="tt"></p><ul>
<li><span class="tt">setup_once</span></li>
<li><span class="tt">teardown_once</span></li>
<li><span class="tt">setup</span></li>
<li><span class="tt">teardown</span></li>
</ul>
<p></span></p>
<p><span class="tt">The <span class="tt">setup_once</span> and <span class="tt">teardown_once</span> are run once before and after all the tests in the suite respectively. They operate in the scratch directory for the test suite, which is the parent directory of each scratch directory for each test case. They can do work that is shared between tests to improve test efficiency. For example, the <span class="tt">dictionaries/setup_once</span> script builds several dictionaries, for use in the <span class="tt">dictionaries</span> tests.</span></p>
<p><span class="tt">The <span class="tt">setup</span> and <span class="tt">teardown</span> scripts run before and after each test case respectively, in the test case's scratch directory. These scripts can do work that is shared between test cases to make tests more succinct. For example, the <span class="tt">dictionaries/setup</span> script copies the dictionaries built by the <span class="tt">dictionaries/setup_once</span> script into the test's scratch directory, to make them easier to use, and make sure they aren't accidentally modified.</span></p>
<p><span class="tt"></span></p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md237"></a>
<span class="tt">Examples</span></h3>
<p><span class="tt"></span></p>
<p><span class="tt"></p><div class="fragment"><div class="line">basic/setup</div>
<div class="line">---</div>
<div class="line">#!/bin/sh</div>
<div class="line"># Create some files for testing with</div>
<div class="line">datagen &gt; file</div>
<div class="line">datagen &gt; file0</div>
<div class="line">datagen &gt; file1</div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">basic/test.sh</div>
<div class="line">---</div>
<div class="line">#!/bin/sh</div>
<div class="line">zstd file file0 file1</div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">dictionaries/setup_once</div>
<div class="line">---</div>
<div class="line">#!/bin/sh</div>
<div class="line">set -e</div>
<div class="line"> </div>
<div class="line">mkdir files/ dicts/</div>
<div class="line">for i in $(seq 10); do</div>
<div class="line">    datagen -g1000 &gt; files/$i</div>
<div class="line">done</div>
<div class="line"> </div>
<div class="line">zstd --train -r files/ -o dicts/0</div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">dictionaries/setup</div>
<div class="line">---</div>
<div class="line">#!/bin/sh</div>
<div class="line"> </div>
<div class="line"># Runs in the test case&#39;s scratch directory.</div>
<div class="line"># The test suite&#39;s scratch directory that</div>
<div class="line"># `setup_once` operates in is the parent directory.</div>
<div class="line">cp -r ../files ../dicts .</div>
<div class="line">---</div>
</div><!-- fragment --><p> 
</span></p>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_c6310732a22f63c0c2fc5595561e68f1.html">Core</a></li><li class="navelem"><a href="dir_6c155c6ed2482937e47e44c0ec262982.html">bin</a></li><li class="navelem"><a href="dir_6469104bc24381b08969a83caf11cffb.html">Debug</a></li><li class="navelem"><a href="dir_6bbd6f73285aef4922f9164785e3a6d0.html">_deps</a></li><li class="navelem"><a href="dir_6db096f061106655854804296419a647.html">zstd-src</a></li><li class="navelem"><a href="dir_d96a6df65abaaa44034ca58a0e200722.html">tests</a></li><li class="navelem"><a href="dir_a7ef9f30002de756fbd7fdf8e5bff6f7.html">cli-tests</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
