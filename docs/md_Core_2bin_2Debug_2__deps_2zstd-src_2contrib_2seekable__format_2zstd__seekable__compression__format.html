<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VEX Engine: Zstandard Seekable Format</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="RenderedLogoLowRes.png"/></td>
  <td id="projectalign">
   <div id="projectname">VEX Engine
   </div>
   <div id="projectbrief">Retro looking game engine made in vulkan mostly because i wanted to understand it better.</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_Core_2bin_2Debug_2__deps_2zstd-src_2contrib_2seekable__format_2zstd__seekable__compression__format.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Zstandard Seekable Format </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md38"></a></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md39"></a>
Notices</h2>
<p>Copyright (c) Meta Platforms, Inc. and affiliates.</p>
<p>Permission is granted to copy and distribute this document for any purpose and without charge, including translations into other languages and incorporation into compilations, provided that the copyright notice and this notice are preserved, and that any substantive changes or deletions from the original are clearly marked. Distribution of this document is unlimited.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md40"></a>
Version</h2>
<p>0.1.0 (11/04/17)</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md41"></a>
Introduction</h1>
<p>This document defines a format for compressed data to be stored so that subranges of the data can be efficiently decompressed without requiring the entire document to be decompressed. This is done by splitting up the input data into frames, each of which are compressed independently, and so can be decompressed independently. Decompression then takes advantage of a provided 'seek table', which allows the decompressor to immediately jump to the desired data. This is done in a way that is compatible with the original Zstandard format by placing the seek table in a Zstandard skippable frame.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md42"></a>
Overall conventions</h2>
<p>In this document:</p><ul>
<li>square brackets i.e. <span class="tt">[</span> and <span class="tt">]</span> are used to indicate optional fields or parameters.</li>
<li>the naming convention for identifiers is <span class="tt">Mixed_Case_With_Underscores</span></li>
<li>All numeric fields are little-endian unless specified otherwise</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md43"></a>
Format</h1>
<p>The format consists of a number of frames (Zstandard compressed frames and skippable frames), followed by a final skippable frame at the end containing the seek table.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md44"></a>
Seek Table Format</h2>
<p>The structure of the seek table frame is as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><span class="tt">Skippable_Magic_Number</span>  </th><th class="markdownTableHeadNone"><span class="tt">Frame_Size</span>  </th><th class="markdownTableHeadNone"><span class="tt">[Seek_Table_Entries]</span>  </th><th class="markdownTableHeadNone"><span class="tt">Seek_Table_Footer</span>  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4 bytes  </td><td class="markdownTableBodyNone">4 bytes  </td><td class="markdownTableBodyNone">8-12 bytes each  </td><td class="markdownTableBodyNone">9 bytes  </td></tr>
</table>
<p><b><span class="tt">Skippable_Magic_Number</span></b></p>
<p>Value : 0x184D2A5E. This is for compatibility with <a href="https://github.com/facebook/zstd/blob/release/doc/zstd_compression_format.md#skippable-frames">Zstandard skippable frames</a>. Since it is legal for other Zstandard skippable frames to use the same magic number, it is not recommended for a decoder to recognize frames solely on this.</p>
<p><b><span class="tt">Frame_Size</span></b></p>
<p>The total size of the skippable frame, not including the <span class="tt">Skippable_Magic_Number</span> or <span class="tt">Frame_Size</span>. This is for compatibility with <a href="https://github.com/facebook/zstd/blob/release/doc/zstd_compression_format.md#skippable-frames">Zstandard skippable frames</a>.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md45"></a>
<span class="tt">Seek_Table_Footer</span></h3>
<p>The seek table footer format is as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><span class="tt">Number_Of_Frames</span>  </th><th class="markdownTableHeadNone"><span class="tt">Seek_Table_Descriptor</span>  </th><th class="markdownTableHeadNone"><span class="tt">Seekable_Magic_Number</span>  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4 bytes  </td><td class="markdownTableBodyNone">1 byte  </td><td class="markdownTableBodyNone">4 bytes  </td></tr>
</table>
<p><b><span class="tt">Seekable_Magic_Number</span></b></p>
<p>Value : 0x8F92EAB1. This value must be the last bytes present in the compressed file so that decoders can efficiently find it and determine if there is an actual seek table present.</p>
<p><b><span class="tt">Number_Of_Frames</span></b></p>
<p>The number of stored frames in the data.</p>
<p><b><span class="tt">Seek_Table_Descriptor</span></b></p>
<p>A bitfield describing the format of the seek table.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Bit number  </th><th class="markdownTableHeadNone">Field name  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">7  </td><td class="markdownTableBodyNone"><span class="tt">Checksum_Flag</span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">6-2  </td><td class="markdownTableBodyNone"><span class="tt">Reserved_Bits</span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1-0  </td><td class="markdownTableBodyNone"><span class="tt">Unused_Bits</span>  </td></tr>
</table>
<p>While only <span class="tt">Checksum_Flag</span> currently exists, there are 7 other bits in this field that can be used for future changes to the format, for example the addition of inline dictionaries.</p>
<p><b><span class="tt">Checksum_Flag</span></b></p>
<p>If the checksum flag is set, each of the seek table entries contains a 4 byte checksum of the uncompressed data contained in its frame.</p>
<p><span class="tt">Reserved_Bits</span> are not currently used but may be used in the future for breaking changes, so a compliant decoder should ensure they are set to 0. <span class="tt">Unused_Bits</span> may be used in the future for non-breaking changes, so a compliant decoder should not interpret these bits.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md46"></a>
<b><span class="tt">Seek_Table_Entries</span></b></h3>
<p><span class="tt">Seek_Table_Entries</span> consists of <span class="tt">Number_Of_Frames</span> (one for each frame in the data, not including the seek table frame) entries of the following form, in sequence:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><span class="tt">Compressed_Size</span>  </th><th class="markdownTableHeadNone"><span class="tt">Decompressed_Size</span>  </th><th class="markdownTableHeadNone"><span class="tt">[Checksum]</span>  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4 bytes  </td><td class="markdownTableBodyNone">4 bytes  </td><td class="markdownTableBodyNone">4 bytes  </td></tr>
</table>
<p><b><span class="tt">Compressed_Size</span></b></p>
<p>The compressed size of the frame. The cumulative sum of the <span class="tt">Compressed_Size</span> fields of frames <span class="tt">0</span> to <span class="tt">i</span> gives the offset in the compressed file of frame <span class="tt">i+1</span>.</p>
<p><b><span class="tt">Decompressed_Size</span></b></p>
<p>The size of the decompressed data contained in the frame. For skippable or otherwise empty frames, this value is 0.</p>
<p><b><span class="tt">Checksum</span></b></p>
<p>Only present if <span class="tt">Checksum_Flag</span> is set in the <span class="tt">Seek_Table_Descriptor</span>. Value : the least significant 32 bits of the XXH64 digest of the uncompressed data, stored in little-endian format.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md47"></a>
Version Changes</h1>
<ul>
<li>0.1.0: initial version </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
